/**
 * [배추] 로직 v2.8 - JavaScript/Node.js 최종 이식 버전
 * 디자인: 두 나물 오직 (Logic A + 01) & 7-가죽나무 통합
 */

const fs = require('fs');

class BaechuLogicV2_8 {
    constructor(filePath) {
        this.filePath = filePath;
    }

    // [7-가죽나무 통합] 데이터 로드 (보너스 포함 7개 번호 동일 지위)
    loadData() {
        const content = fs.readFileSync(this.filePath, 'utf-8');
        return content.trim().split('\n')
            .map(line => line.split('\t').slice(2, 9).map(Number))
            .filter(row => row.length === 7);
    }

    generate(totalCount = 5) {
        const data = this.loadData();
        const past12Rounds = data.slice(0, 12); // 최근 12회차 전수 분석

        // 1. 빈도 및 구간 통계 (가변 구간 에너지 계산용)
        let hotNumbers = {};
        let sectionCounts = [0, 0, 0, 0, 0]; // 0~4 구간

        past12Rounds.forEach(row => {
            row.forEach(num => {
                hotNumbers[num] = (hotNumbers[num] || 0) + 1;
                let sIdx = Math.min(Math.floor((num - 1) / 10), 4);
                sectionCounts[sIdx]++;
            });
        });

        // 2. [엄격 퇴출] 12회 내 5회 이상 출현수 제거
        const banList = Object.keys(hotNumbers).filter(n => hotNumbers[n] >= 5).map(Number);

        // 3. 가변 구간 에너지 가중치 산출 (침체 구간 점수 증폭)
        const avgHit = sectionCounts.reduce((a, b) => a + b) / 5;
        const sectionWeights = sectionCounts.map(count => 
            Math.max(1.0, Math.min(2.0, (avgHit + 1) / (count + 1)))
        );

        // 4. [두 나물 오직] 풀 구성 (상위 22수 추출)
        let candidates = [];
        for (let i = 1; i <= 45; i++) {
            if (banList.includes(i)) continue;
            let score = 1.0 / ((hotNumbers[i] || 0) + 1);
            let sIdx = Math.min(Math.floor((i - 1) / 10), 4);
            score *= sectionWeights[sIdx]; // 에너지 증폭 적용
            candidates.push({ num: i, score });
        }

        const final12Core = candidates.sort((a, b) => b.score - a.score).slice(0, 12).map(v => v.num);

        // 5. 최종 5조합 출력 디자인
        console.log("=== [배추] v2.8 통합 로직 분석 결과 ===");
        console.log(`퇴출 명단(과열): ${banList.join(', ')}`);
        console.log(`핵심 12수: ${final12Core.join(', ')}`);
        console.log("---------------------------------------");

        for (let i = 1; i <= totalCount; i++) {
            let combo = [];
            if (i === 1) {
                combo = final12Core.slice(0, 7); // 1번 조합: 최상위 에너지 7수
            } else {
                let pool = [...final12Core];
                while (combo.length < 7) {
                    let idx = Math.floor(Math.random() * pool.length);
                    combo.push(pool.splice(idx, 1)[0]);
                }
            }
            console.log(`조합 ${i}: [ ${combo.sort((a, b) => a - b).join(', ')} ]`);
        }
    }
}

// 실행
const engine = new BaechuLogicV2_8('로또1-1205당첨리스트.txt');
engine.generate();
