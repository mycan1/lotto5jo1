import tkinter as tk
from tkinter import messagebox
import random
from collections import Counter

# ==========================================
# 1. 데이터 관리부 (전체데이터 93개 완벽 수록)
# ==========================================
def get_entire_data():
    return [
        [1205, 1, 4, 16, 23, 31, 41], [1204, 8, 16, 28, 30, 31, 44], [1203, 3, 6, 18, 29, 35, 39],
        [1202, 5, 12, 21, 33, 37, 40], [1201, 7, 9, 24, 27, 35, 36], [1200, 1, 2, 4, 16, 20, 32],
        [1199, 16, 24, 25, 30, 31, 32], [1198, 26, 30, 33, 38, 39, 41], [1197, 1, 5, 7, 26, 28, 43],
        [1196, 8, 12, 15, 29, 40, 45], [1195, 3, 15, 27, 33, 34, 36], [1194, 3, 13, 15, 24, 33, 37],
        [1193, 6, 9, 16, 19, 24, 28], [1192, 10, 16, 23, 36, 39, 40], [1191, 1, 4, 11, 12, 20, 41],
        [1190, 7, 9, 19, 23, 26, 45], [1189, 9, 19, 29, 35, 37, 38], [1188, 3, 4, 12, 19, 22, 27],
        [1187, 5, 13, 26, 29, 37, 40], [1186, 2, 8, 13, 16, 23, 28], [1185, 6, 17, 22, 28, 29, 32],
        [1184, 14, 16, 23, 25, 31, 37], [1183, 4, 15, 17, 23, 27, 36], [1182, 1, 13, 21, 25, 28, 31],
        [1181, 8, 10, 14, 20, 33, 41], [1180, 6, 12, 18, 37, 40, 41], [1179, 3, 16, 18, 24, 40, 44],
        [1178, 5, 6, 11, 27, 43, 44], [1177, 3, 7, 15, 16, 19, 43], [1176, 7, 9, 11, 21, 30, 35],
        [1175, 3, 4, 6, 8, 32, 42], [1174, 8, 11, 14, 17, 36, 39], [1173, 1, 5, 18, 20, 30, 35],
        [1172, 7, 9, 24, 40, 42, 44], [1171, 3, 6, 7, 11, 12, 17], [1170, 3, 13, 28, 34, 38, 42],
        [1169, 5, 12, 24, 26, 39, 42], [1168, 9, 21, 24, 30, 33, 37], [1167, 8, 23, 31, 35, 39, 40],
        [1166, 14, 23, 25, 27, 29, 42], [1165, 6, 7, 27, 29, 38, 45], [1164, 17, 18, 23, 25, 38, 39],
        [1163, 2, 13, 15, 16, 33, 43], [1162, 20, 21, 22, 25, 28, 29], [1161, 2, 12, 20, 24, 34, 42],
        [1160, 7, 13, 18, 36, 39, 45], [1159, 3, 9, 27, 28, 38, 39], [1158, 21, 25, 27, 32, 37, 38],
        [1157, 5, 7, 12, 20, 25, 26], [1156, 30, 31, 34, 39, 41, 45], [1155, 10, 16, 19, 27, 37, 38],
        [1154, 4, 8, 22, 26, 32, 38], [1153, 1, 9, 10, 13, 35, 44], [1152, 30, 31, 32, 35, 36, 37],
        [1151, 2, 3, 9, 15, 27, 29], [1150, 8, 9, 18, 35, 39, 45], [1149, 8, 15, 19, 21, 32, 36],
        [1148, 3, 6, 13, 15, 16, 22], [1147, 7, 11, 24, 26, 27, 37], [1146, 6, 11, 17, 19, 40, 43],
        [1145, 2, 11, 31, 33, 37, 44], [1144, 3, 4, 12, 15, 26, 34], [1143, 10, 16, 17, 27, 28, 36],
        [1142, 2, 8, 28, 30, 37, 41], [1141, 7, 11, 12, 21, 26, 35], [1140, 7, 10, 22, 29, 31, 38],
        [1139, 5, 12, 15, 30, 37, 40], [1138, 14, 16, 19, 20, 29, 34], [1137, 4, 9, 12, 15, 33, 45],
        [1136, 21, 33, 35, 38, 42, 44], [1135, 1, 6, 13, 19, 21, 33], [1134, 3, 7, 9, 13, 19, 24],
        [1133, 13, 14, 20, 28, 29, 34], [1132, 6, 7, 19, 28, 34, 41], [1131, 1, 2, 6, 14, 27, 38],
        [1130, 15, 19, 21, 25, 27, 28], [1129, 5, 10, 11, 17, 28, 34], [1128, 1, 5, 8, 16, 28, 33],
        [1127, 10, 15, 24, 30, 31, 37], [1126, 4, 5, 9, 11, 37, 40], [1125, 6, 14, 25, 33, 40, 44],
        [1124, 3, 8, 17, 30, 33, 34], [1123, 13, 19, 21, 24, 34, 35], [1122, 3, 6, 21, 30, 34, 35],
    ]

# ==========================================
# 2. 통합 분석 엔진
# ==========================================
class AnalysisEngine:
    @staticmethod
    def get_compressed_12(raw_data):
        all_nums = [n for sub in raw_data for n in sub[1:]]
        freq = Counter(all_nums)
        gold_nums = [n for n, c in freq.most_common(8)]
        recent_15 = [n for sub in raw_data[:15] for n in sub[1:]]
        unseen = [n for n in range(1, 45) if n not in recent_15]
        unseen_sorted = sorted(unseen, key=lambda x: freq.get(x, 0), reverse=True)
        long_term_nums = unseen_sorted[:4]
        compressed_12 = sorted(list(set(gold_nums + long_term_nums)))
        while len(compressed_12) < 12:
            r = random.randint(1, 45)
            if r not in compressed_12: compressed_12.append(r)
        return sorted(compressed_12[:12])

    @staticmethod
    def apply_consecutive_logic(pool, size=6):
        while True:
            combo = sorted(random.sample(pool, size))
            has_consecutive = any(combo[i]+1 == combo[i+1] for i in range(len(combo)-1))
            if random.random() < 0.6:
                if has_consecutive: return combo
            else:
                if not has_consecutive: return combo

# ==========================================
# 3. GUI 및 앱 제어
# ==========================================
class GodOfLottoApp:
    def __init__(self, root):
        self.root = root
        self.entire_data = get_entire_data()
        self.usage_count = 0 
        
        self.root.title("GOD OF LOTTO")
        self.root.geometry("480x850")
        self.root.configure(bg="#121212")
        self._setup_ui()

    def _setup_ui(self):
        header = tk.Frame(self.root, bg="#121212", pady=30)
        header.pack(fill="x")
        tk.Label(header, text="GOD OF LOTTO", font=("Arial Black", 34), fg="#D4AF37", bg="#121212").pack()
        
        self.status_lbl = tk.Label(header, text=f"분석 가능 횟수: 2회 남음", 
                                   font=("Malgun Gothic", 11, "bold"), fg="#00FFCC", bg="#121212")
        self.status_lbl.pack()

        btn_frame = tk.Frame(self.root, bg="#121212")
        btn_frame.pack(pady=10)

        s_gold = {"font": ("Malgun Gothic", 12, "bold"), "width": 19, "height": 3, "bg": "#D4AF37", "fg": "black", "relief": "flat", "cursor": "hand2"}
        s_dark = {"font": ("Malgun Gothic", 12, "bold"), "width": 19, "height": 3, "bg": "#2A2A2A", "fg": "white", "relief": "flat", "cursor": "hand2"}

        self.btn_5 = tk.Button(btn_frame, text="5조합 생성하기\n(압축 12수)", **s_gold, command=lambda: self.process("5"))
        self.btn_5.grid(row=0, column=0, padx=8, pady=8)
        
        self.btn_10 = tk.Button(btn_frame, text="10조합 생성하기\n(20수 확장)", **s_gold, command=lambda: self.process("10"))
        self.btn_10.grid(row=0, column=1, padx=8, pady=8)
        
        tk.Button(btn_frame, text="당첨 인증", **s_dark, command=lambda: messagebox.showinfo("인증", "인증 게시판 연결")).grid(row=1, column=0, padx=8, pady=8)
        tk.Button(btn_frame, text="기부하기", **s_dark, command=lambda: messagebox.showinfo("기부", "행운 나눔 연결")).grid(row=1, column=1, padx=8, pady=8)

        self.console = tk.Text(self.root, height=14, width=50, bg="#1E1E1E", fg="#FFD700", 
                               font=("Consolas", 12), bd=0, padx=20, pady=20, 
                               insertbackground="white", selectbackground="#D4AF37")
        self.console.pack(pady=20)
        self.console.insert(tk.END, "▶ 내 원본만이 진실이다.\n▶ 번호 생성 후 마우스로 드래그하여 복사하세요.\n" + "="*35 + "\n")

    def process(self, mode):
        if self.usage_count >= 2:
            messagebox.showwarning("제한", "금일 추출 횟수를 모두 사용하였습니다.")
            return

        self.usage_count += 1
        self.status_lbl.config(text=f"분석 가능 횟수: {2 - self.usage_count}회 남음")
        self.console.delete('1.0', tk.END)
        self.console.insert(tk.END, f"▶ [{mode}조합] 생성 완료 ({self.usage_count}/2회)\n" + "-"*40 + "\n")
        
        c12 = AnalysisEngine.get_compressed_12(self.entire_data)
        pool = c12 if mode == "5" else sorted(c12 + random.sample([n for n in range(1, 46) if n not in c12], 8))
        count = 5 if mode == "5" else 10
            
        for _ in range(count):
            res = AnalysisEngine.apply_consecutive_logic(pool)
            self.console.insert(tk.END, f"{'  '.join(f'{n:02d}' for n in res)}\n")
            
        if self.usage_count >= 2:
            self.btn_5.config(state="disabled", bg="#444444")
            self.btn_10.config(state="disabled", bg="#444444")

# [중요] 들여쓰기가 가장 바깥쪽(맨 왼쪽)에 딱 붙어있어야 창이 뜹니다.
if __name__ == "__main__":
    root = tk.Tk()
    app = GodOfLottoApp(root)
    root.mainloop()
